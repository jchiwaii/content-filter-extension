<!DOCTYPE html>
<html>
<head>
  <title>Debug Storage</title>
  <style>
    body {
      font-family: 'Courier New', monospace;
      padding: 40px;
      max-width: 900px;
      margin: 0 auto;
      background: #1e1e1e;
      color: #d4d4d4;
    }
    h1 {
      color: #4ec9b0;
    }
    .output {
      background: #252526;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      border: 1px solid #3e3e42;
    }
    .key {
      color: #9cdcfe;
    }
    .string {
      color: #ce9178;
    }
    .number {
      color: #b5cea8;
    }
    .boolean {
      color: #569cd6;
    }
    button {
      background: #0e639c;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 10px;
    }
    button:hover {
      background: #1177bb;
    }
    .success {
      color: #4ec9b0;
    }
    .error {
      color: #f48771;
    }
    pre {
      margin: 0;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
  </style>
</head>
<body>
  <h1>üîç Storage Debugger</h1>

  <div>
    <button onclick="checkStorage()">Check Storage</button>
    <button onclick="testFiltering()">Test Filtering</button>
    <button onclick="clearStorage()">Clear Storage</button>
  </div>

  <div class="output">
    <h2>Extension Storage Contents:</h2>
    <pre id="storageOutput">Click "Check Storage" to see what's saved...</pre>
  </div>

  <div class="output">
    <h2>Custom Words Test:</h2>
    <p>Testing these words: <strong>javascript, curse, banana, text</strong></p>
    <p id="test1">I love javascript programming.</p>
    <p id="test2">Don't curse in public.</p>
    <p id="test3">I eat a banana every day.</p>
    <p id="test4">This is some text content.</p>
    <pre id="testOutput">Click "Test Filtering" to check if custom words work...</pre>
  </div>

  <div class="output">
    <h2>Console Instructions:</h2>
    <p>Open DevTools (F12) and paste this to manually check storage:</p>
    <pre style="background: #1e1e1e; padding: 15px; border-radius: 4px;">
chrome.storage.sync.get(['config'], (result) => {
  console.log('üì¶ Full storage:', result);
  console.log('üìù Custom words:', result.config?.customWords);
  console.log('‚öôÔ∏è  Full config:', result.config);
});</pre>
  </div>

  <script>
    function checkStorage() {
      const output = document.getElementById('storageOutput');
      output.innerHTML = 'Loading...';

      chrome.storage.sync.get(['config'], (result) => {
        if (chrome.runtime.lastError) {
          output.innerHTML = `<span class="error">Error: ${chrome.runtime.lastError.message}</span>`;
          return;
        }

        if (!result.config) {
          output.innerHTML = '<span class="error">No config found in storage!</span>';
          return;
        }

        // Pretty print the config
        const formatted = JSON.stringify(result.config, null, 2);
        output.innerHTML = `<span class="success">‚úÖ Config found!</span>\n\n${formatted}`;

        // Also log to console
        console.log('='.repeat(60));
        console.log('STORAGE DEBUG:');
        console.log('='.repeat(60));
        console.log('Full storage:', result);
        console.log('Config:', result.config);
        console.log('Custom words:', result.config.customWords);
        console.log('Custom words count:', result.config.customWords?.length || 0);
        console.log('='.repeat(60));
      });
    }

    function testFiltering() {
      const output = document.getElementById('testOutput');

      if (!window.containsProfanity || !window.censorProfanity) {
        output.innerHTML = '<span class="error">‚ùå Profanity functions not loaded!</span>';
        return;
      }

      chrome.storage.sync.get(['config'], (result) => {
        const customWords = result.config?.customWords || [];
        const filterLevel = result.config?.strictMode ? 'all' : 'moderate';

        output.innerHTML = `Testing with custom words: ${JSON.stringify(customWords)}\n`;
        output.innerHTML += `Filter level: ${filterLevel}\n\n`;

        const tests = [
          { id: 'test1', text: 'I love javascript programming.' },
          { id: 'test2', text: "Don't curse in public." },
          { id: 'test3', text: 'I eat a banana every day.' },
          { id: 'test4', text: 'This is some text content.' }
        ];

        let results = '';
        tests.forEach((test, i) => {
          const hasProfanity = window.containsProfanity(test.text, filterLevel, customWords);
          const censored = window.censorProfanity(test.text, filterLevel, '*', customWords);
          const changed = test.text !== censored;

          results += `Test ${i + 1}:\n`;
          results += `  Original: "${test.text}"\n`;
          results += `  Filtered: "${censored}"\n`;
          results += `  Contains profanity: ${hasProfanity}\n`;
          results += `  Changed: ${changed ? '‚úÖ YES' : '‚ùå NO'}\n\n`;

          // Update the actual paragraph
          document.getElementById(test.id).textContent = censored;
        });

        output.innerHTML += results;

        // Log to console
        console.log('='.repeat(60));
        console.log('FILTERING TEST:');
        console.log('='.repeat(60));
        console.log('Custom words:', customWords);
        console.log('Results:\n', results);
        console.log('='.repeat(60));
      });
    }

    function clearStorage() {
      if (confirm('Clear all storage? This will reset all settings!')) {
        chrome.storage.sync.clear(() => {
          document.getElementById('storageOutput').innerHTML = '<span class="success">‚úÖ Storage cleared!</span>';
          console.log('Storage cleared');
        });
      }
    }

    // Auto-check on load
    window.onload = () => {
      console.log('Debug page loaded. Profanity functions available:', {
        containsProfanity: typeof window.containsProfanity,
        censorProfanity: typeof window.censorProfanity,
        findProfanity: typeof window.findProfanity
      });

      setTimeout(() => {
        checkStorage();
      }, 500);
    };
  </script>
</body>
</html>
